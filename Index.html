<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‚öΩ Matches en Direct ‚Äî Live Notifications</title>
<style>
:root{--bg:#0f1112;--card:#1e2226;--muted:#999;--accent:#ffcc00}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#eee}
header{background:#0b0c0d;padding:14px;text-align:center;border-bottom:1px solid #121314;font-size:18px;font-weight:600}
.controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:12px;justify-content:center;background:#0e1012;border-bottom:1px solid #161718}
select,input,button,label{font-size:14px}
select,input{padding:8px;border-radius:6px;border:1px solid #222;background:#0c0d0e;color:#eee}
button{padding:8px 12px;border-radius:6px;border:none;background:var(--accent);color:#111;cursor:pointer}
button.ghost{background:transparent;border:1px solid #333;color:#eee}
main{padding:12px}
.notice{color:var(--muted);text-align:center;margin:8px 0}
#matches{display:block;max-width:980px;margin:12px auto}
.league-block{margin-bottom:18px}
.league-title{font-weight:700;margin-bottom:8px}
.match{background:var(--card);padding:10px;border-radius:10px;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,0.4)}
.match-row{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.team{display:flex;align-items:center;gap:8px}
.team img{width:28px;height:28px;object-fit:contain;border-radius:4px}
.score{font-weight:700;color:var(--accent);font-size:1.05rem}
.time{color:var(--muted);font-size:13px;margin-top:6px}
.progress-container{height:6px;background:#111;border-radius:6px;overflow:hidden;margin-top:8px}
.progress-bar{height:6px;background:var(--accent);width:0%;transition:width .4s linear}
.notification{position:fixed;top:20px;right:20px;background:var(--accent);color:#111;padding:10px 14px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,0.7);z-index:999;font-weight:600;display:none}
</style>
</head>
<body>
<header>‚öΩ Matches en Direct ‚Äî Live Notifications</header>

<div class="controls">
  <label>
    Ligue
    <select id="league">
      <option value="all">üåç Toutes les ligues</option>
      <option value="39">Premier League</option>
      <option value="61">Ligue 1</option>
      <option value="140">La Liga</option>
      <option value="135">Serie A</option>
      <option value="78">Bundesliga</option>
      <option value="2">Champions League</option>
      <option value="3">Europa League</option>
      <option value="848">Europa Conference</option>
      <option value="999">Ecureu Cup</option>
      <option value="CWQ_EU">√âliminatoires CDM Europe</option>
      <option value="CWQ_AF">√âliminatoires CDM Afrique</option>
      <option value="CWQ_AS">√âliminatoires CDM Asie</option>
      <option value="CWQ_AM">√âliminatoires CDM Am√©rique</option>
    </select>
  </label>
  <label>
    Date
    <input type="date" id="date">
  </label>
  <button id="refresh">üîÑ Actualiser</button>
</div>

<main>
  <div class="notice">Les notifications apparaissent pour chaque but ou changement important.</div>
  <div id="matches" aria-live="polite"></div>
</main>

<div class="notification" id="notif"></div>

<script>
// === CONFIG ===
const API_KEY = "637d4720156cd4c3ed34d17adcd4154e"; // cl√© API valide
const API_URL = "https://v3.football.api-sports.io/fixtures";
const REFRESH_INTERVAL = 30000; // 30s

const $ = id => document.getElementById(id);
const leagueEl = $("league");
const dateEl = $("date");
const refreshBtn = $("refresh");
const matchesEl = $("matches");
const notifEl = $("notif");

dateEl.value = new Date().toISOString().slice(0,10);

// === STATE ===
let previousScores = {};

// === UTILITAIRES ===
function localYMD(d = new Date()) {
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}

function showNotification(message){
  notifEl.textContent = message;
  notifEl.style.display = "block";
  setTimeout(()=> notifEl.style.display="none", 5000);
  // son simple
  const audio = new Audio("https://www.soundjay.com/button/beep-07.mp3");
  audio.play().catch(()=>{});
}

// === FETCH MATCHES ===
async function fetchMatches(date, league){
  const trimmedKey = API_KEY.trim();
  if(!trimmedKey) throw new Error("Cl√© API absente");

  let url = `${API_URL}?date=${date}&season=${new Date().getFullYear()}`;

  const cwqMapping = {
    "CWQ_EU": 101,
    "CWQ_AF": 102,
    "CWQ_AS": 103,
    "CWQ_AM": 104
  };
  if(league && league!=="all") url += `&league=${cwqMapping[league]||league}`;

  const res = await fetch(url,{headers:{"x-apisports-key":trimmedKey}});
  if(!res.ok) throw new Error(`HTTP ${res.status}`);
  const json = await res.json();
  return json.response || [];
}

// === RENDER MATCHES ===
function renderMatches(fixtures){
  matchesEl.innerHTML = "";
  if(!fixtures.length){
    matchesEl.innerHTML = `<div style="padding:12px;color:#ccc">Aucun match trouv√©.</div>`;
    return;
  }

  fixtures.forEach(fix=>{
    const matchId = fix.fixture.id;
    const home = fix.teams.home.name;
    const away = fix.teams.away.name;
    const homeLogo = fix.teams.home.logo||"https://via.placeholder.com/32";
    const awayLogo = fix.teams.away.logo||"https://via.placeholder.com/32";
    const homeScore = fix.goals.home ?? "-";
    const awayScore = fix.goals.away ?? "-";
    const elapsed = fix.fixture.status.elapsed;
    const status = fix.fixture.status.long||fix.fixture.status.short;
    const progress = elapsed ? Math.min(Number(elapsed),100) : 0;

    // V√©rification but
    const prev = previousScores[matchId]||{home:homeScore,away:awayScore};
    if(prev.home!==homeScore) showNotification(`‚öΩ But pour ${home} !`);
    if(prev.away!==awayScore) showNotification(`‚öΩ But pour ${away} !`);
    previousScores[matchId] = {home:homeScore,away:awayScore};

    const matchDiv = document.createElement("div");
    matchDiv.className = "match";
    matchDiv.innerHTML = `
      <div class="match-row">
        <div class="team"><img src="${homeLogo}" alt="${home}"><div>${home}</div></div>
        <div class="score">${homeScore} - ${awayScore}</div>
        <div class="team" style="justify-content:flex-end"><div>${away}</div><img src="${awayLogo}" alt="${away}"></div>
      </div>
      <div class="time">${elapsed?elapsed+"' ‚Ä¢ "+status:status}</div>
      <div class="progress-container"><div class="progress-bar" style="width:${progress}%"></div></div>
    `;
    matchesEl.appendChild(matchDiv);
  });
}

// === LOAD MATCHES ===
async function loadMatches(){
  matchesEl.innerHTML = `<div style="padding:10px;color:#aaa">Chargement‚Ä¶</div>`;
  try{
    const fixtures = await fetchMatches(dateEl.value, leagueEl.value);
    renderMatches(fixtures);
  }catch(err){
    matchesEl.innerHTML = `<div style="padding:12px;color:#ff6b6b">Erreur : ${err.message}</div>`;
    console.error(err);
  }
}

// === EVENTS ===
leagueEl.addEventListener("change", loadMatches);
dateEl.addEventListener("change", loadMatches);
refreshBtn.addEventListener("click", loadMatches);
setInterval(loadMatches, REFRESH_INTERVAL);

// Initial load
loadMatches();
</script>
</body>
</html>
