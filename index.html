<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚öΩ Matches en Direct - √âliminatoires WC</title>
<style>
:root {--bg:#0f1112;--card:#1e2226;--muted:#999;--accent:#ffcc00;}
body {margin:0;font-family:Arial,sans-serif;background:var(--bg);color:#eee;}
header {background:#0b0c0d;padding:14px;text-align:center;font-size:18px;font-weight:bold;}
.controls {display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:12px;justify-content:center;background:#0e1012;}
select,input,button {font-size:14px;padding:8px;border-radius:6px;border:1px solid #222;background:#0c0d0e;color:#eee;}
button {background:var(--accent);color:#111;cursor:pointer;}
button:hover {background:#ffd633;}
#matches {max-width:980px;margin:12px auto;}
.league-block {margin-bottom:18px;}
.league-title {font-weight:700;margin-bottom:8px;}
.match {background:var(--card);padding:10px;border-radius:10px;margin:8px 0;box-shadow:0 2px 8px rgba(0,0,0,0.4);}
.match-row {display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
.team {display:flex;align-items:center;gap:8px;}
.team img {width:28px;height:28px;object-fit:contain;border-radius:4px;}
.score {font-weight:700;color:var(--accent);font-size:1.05rem;}
.time {color:var(--muted);font-size:13px;margin-top:6px;}
.progress-container {height:6px;background:#111;border-radius:6px;overflow:hidden;margin-top:8px;}
.progress-bar {height:6px;background:var(--accent);width:0%;transition:width .4s linear;}
.notice {text-align:center;color:var(--muted);margin:6px 0;}
</style>
</head>
<body>

<header>‚öΩ Matches en Direct - √âliminatoires Coupe du Monde</header>

<div class="controls">
  <label>Ligue
    <select id="league">
      <option value="all">üåç Toutes les ligues</option>
      <option value="39">Premier League</option>
      <option value="61">Ligue 1</option>
      <option value="140">La Liga</option>
      <option value="135">Serie A</option>
      <option value="78">Bundesliga</option>
      <option value="2">Champions League</option>
      <option value="1234">√âliminatoires WC Europe</option>
      <option value="2345">√âliminatoires WC Afrique</option>
      <option value="3456">√âliminatoires WC Asie</option>
      <option value="4567">√âliminatoires WC Am√©rique du Sud</option>
      <option value="5678">√âliminatoires WC Am√©rique du Nord</option>
    </select>
  </label>

  <label>Date
    <input type="date" id="date">
  </label>

  <button id="refresh">üîÑ Actualiser</button>
</div>

<div class="notice">S√©lectionne la ligue et la date pour voir les matches en direct.</div>

<div id="matches"></div>

<script>
const API_KEY = "637d4720156cd4c3ed34d17adcd4154e"; // <-- Remplace par ta cl√© API valide
const API_URL = "https://v3.football.api-sports.io/fixtures";
const REFRESH_INTERVAL = 60000;

const leagueEl = document.getElementById("league");
const dateEl = document.getElementById("date");
const refreshBtn = document.getElementById("refresh");
const matchesEl = document.getElementById("matches");

function localYMD(d = new Date()){
  const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,"0"), day=String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}
dateEl.value = localYMD();

async function fetchMatches(date, league){
  const params = new URLSearchParams({date, season: new Date().getFullYear()});
  if(league && league !== "all") params.set("league", league);
  const url = `${API_URL}?${params.toString()}`;

  const res = await fetch(url, {
    headers: { "x-apisports-key": API_KEY }
  });
  if (!res.ok) throw new Error(`Erreur API: ${res.status} ${res.statusText}`);
  const data = await res.json();
  if(!data.response) return [];
  return data.response;
}

function renderMatches(fixtures){
  matchesEl.innerHTML = "";
  if(!fixtures || fixtures.length===0){
    matchesEl.innerHTML = "<div style='padding:12px;color:#ccc'>Aucun match trouv√© pour cette ligue / date.</div>";
    return;
  }

  const grouped = fixtures.reduce((acc, f) => {
    const key = `${f.league?.name || "?"} (${f.league?.country || "?"})`;
    (acc[key] = acc[key] || []).push(f);
    return acc;
  }, {});

  for(const leagueName of Object.keys(grouped)){
    const block = document.createElement("div");
    block.className = "league-block";
    const title = document.createElement("div");
    title.className = "league-title";
    title.textContent = leagueName;
    block.appendChild(title);

    grouped[leagueName].forEach(fix => {
      const match = document.createElement("div");
      match.className = "match";
      const homeName = fix.teams.home.name;
      const awayName = fix.teams.away.name;
      const homeLogo = fix.teams.home.logo || "https://via.placeholder.com/32";
      const awayLogo = fix.teams.away.logo || "https://via.placeholder.com/32?text=A";
      const homeScore = (fix.goals.home===null)? "-":fix.goals.home;
      const awayScore = (fix.goals.away===null)? "-":fix.goals.away;
      const elapsed = fix.fixture?.status?.elapsed;
      const statusLong = fix.fixture?.status?.long || fix.fixture?.status?.short || "";
      const timeText = elapsed ? `${elapsed}' ‚Ä¢ ${statusLong}` : statusLong;
      const progress = elapsed ? Math.min(Number(elapsed),100) : 0;

      match.innerHTML = `
        <div class="match-row">
          <div class="team"><img src="${homeLogo}" alt="${homeName}"><div>${homeName}</div></div>
          <div class="score">${homeScore} - ${awayScore}</div>
          <div class="team" style="justify-content:flex-end"><div>${awayName}</div><img src="${awayLogo}" alt="${awayName}"></div>
        </div>
        <div class="time">${timeText}</div>
        <div class="progress-container"><div class="progress-bar" style="width:${progress}%"></div></div>
      `;
      block.appendChild(match);
    });

    matchesEl.appendChild(block);
  }
}

async function loadMatches(){
  matchesEl.innerHTML = "<div style='padding:10px;color:#aaa'>Chargement‚Ä¶</div>";
  const leagueId = leagueEl.value;
  const date = dateEl.value;
  try{
    const fixtures = await fetchMatches(date, leagueId);
    renderMatches(fixtures);
  }catch(e){
    console.error(e);
    matchesEl.innerHTML = `<div style="padding:12px;color:#ff6b6b">Erreur : ${e.message}</div>`;
  }
}

leagueEl.addEventListener("change", loadMatches);
dateEl.addEventListener("change", loadMatches);
refreshBtn.addEventListener("click", loadMatches);

loadMatches();
setInterval(loadMatches, REFRESH_INTERVAL);
</script>

</body>
</html>
